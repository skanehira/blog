<!doctype html><html lang=ja-jp><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=theme-color content="#494f5c"><meta name=msapplication-TileColor content="#494f5c"><meta itemprop=name content="Vimでシェルコマンドを簡単に実行するcommand.vimを作った"><meta itemprop=description content="初めに 普段Vimでターミナルを使ってちょっとしたコマンドを実行することがよくあります。 たとえばgh pr createやlazygit、docui"><meta itemprop=datePublished content="2021-05-20T00:00:00+00:00"><meta itemprop=dateModified content="2021-05-20T00:00:00+00:00"><meta itemprop=wordCount content="2765"><meta itemprop=keywords content="Vim,denops,deno,"><meta property="og:title" content="Vimでシェルコマンドを簡単に実行するcommand.vimを作った"><meta property="og:description" content="初めに 普段Vimでターミナルを使ってちょっとしたコマンドを実行することがよくあります。 たとえばgh pr createやlazygit、docui"><meta property="og:type" content="article"><meta property="og:url" content="https://skanehira.github.io/blog/posts/20210520-vim-plugin-command/"><meta property="article:published_time" content="2021-05-20T00:00:00+00:00"><meta property="article:modified_time" content="2021-05-20T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Vimでシェルコマンドを簡単に実行するcommand.vimを作った"><meta name=twitter:description content="初めに 普段Vimでターミナルを使ってちょっとしたコマンドを実行することがよくあります。 たとえばgh pr createやlazygit、docui"><link rel=apple-touch-icon sizes=180x180 href=/blog/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/blog/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/blog/favicon-16x16.png><link rel=manifest href=/blog/site.webmanifest><link rel=mask-icon href=/blog/safari-pinned-tab.svg color><link rel="shortcut icon" href=/blog/favicon.ico><title>Vimでシェルコマンドを簡単に実行するcommand.vimを作った</title><link rel=stylesheet href=https://skanehira.github.io/blog/css/style.min.eac77496566fd7d5768fd650ddb0b2b181ca6a2d7c5fdd6fe6b8ba4bf47e566f.css integrity="sha256-6sd0llZv19V2j9ZQ3bCysYHKai18X91v5ri6S/R+Vm8=" crossorigin=anonymous></head><body id=page><header id=site-header class="animated slideInUp"><div class="hdr-wrapper section-inner"><div class=hdr-left><div class=site-branding><a href=https://skanehira.github.io/blog/>ゴリラ@転生したら人間だった件</a></div><nav class="site-nav hide-in-mobile"><a href=https://skanehira.github.io/blog/aboutme>About me</a>
<a href=https://skanehira.github.io/blog/posts/>Posts</a>
<a href=https://skanehira.github.io/blog/tags/>Tags</a></nav></div><div class="hdr-right hdr-icons"><button id=toc-btn class="hdr-btn desktop-only-ib"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-list"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3" y2="6"/><line x1="3" y1="12" x2="3" y2="12"/><line x1="3" y1="18" x2="3" y2="18"/></svg></button><span class="hdr-social hide-in-mobile"><a href=https://twitter.com/gorilla0513 target=_blank rel="noopener me" title=Twitter><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a><a href=https://github.com/skanehira target=_blank rel="noopener me" title=Github><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></span><button id=menu-btn class=hdr-btn><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button></div></div></header><div id=mobile-menu class="animated fast"><ul><li><a href=https://skanehira.github.io/blog/aboutme>About me</a></li><li><a href=https://skanehira.github.io/blog/posts/>Posts</a></li><li><a href=https://skanehira.github.io/blog/tags/>Tags</a></li></ul></div><main class="site-main section-inner animated fadeIn faster"><article class=thin><header class=post-header><div class=post-meta><span>2021/05/20</span></div><h1>Vimでシェルコマンドを簡単に実行するcommand.vimを作った</h1></header><div class=content><h2 id=初めに>初めに<a href=#初めに class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2><p>普段Vimでターミナルを使ってちょっとしたコマンドを実行することがよくあります。
たとえば<code>gh pr create</code>や<code>lazygit</code>、<code>docui</code>といった、インタラクティブな操作を必要とするコマンドが多いです。
その度に<code>:term xxx</code>と入力するのは不便だし、コマンドの履歴補完が効かないので、<a href=https://github.com/skanehira/command.vim>command.vim</a>というプラグインを作りました。</p><p>本記事はプラグインの紹介と作るにあたって苦労したことについて書いていきます。</p><h2 id=使い方>使い方<a href=#使い方 class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2><p><img src=https://i.gyazo.com/3b703f3d888526e282693d386051f59e.gif alt></p><p>デモのとおり、<code>command.vim</code>はコマンドを実行するためのバッファを用意していて、そのバッファでコマンド履歴を補完してくれます。
バッファを開くには次のコマンドを使用します。</p><div class=highlight><pre class=chroma><code class=language-vim data-lang=vim><span class=p>:</span><span class=nx>CommandBufferOpen</span><span class=err>
</span></code></pre></div><p>また、キーマップを用意しているので、次のように設定するとすばやくバッファを開けます。</p><div class=highlight><pre class=chroma><code class=language-vim data-lang=vim><span class=nx>nmap</span> <span class=nx>c</span>: <span class=p>&lt;</span><span class=nx>Plug</span><span class=p>&gt;(</span><span class=nx>command_buffer_open</span><span class=p>)</span><span class=err>
</span></code></pre></div><p>コマンドを入力したら<code>Enter</code>で実行します。
シンプルですが、<code>:xxx</code>とほぼ同じ感覚でコマンドをターミナル上で実行できるのでストレスがないです。</p><h2 id=しくみ>しくみ<a href=#しくみ class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2><p><code>command.vim</code>は<a href=https://github.com/vim-denops/denops.vim>denops.vim</a>を使用しています。
<code>denops.vim</code>については<a href=https://zenn.dev/lambdalisue/articles/b4a31fba0b1ce95104c9>こちら</a>の記事で詳しく書かれているのでよかったら読んでみてください。</p><p><code>vim script</code>だけでも実装できたんですが、<code>deno</code>のエコシステムを利用できる<code>denops.vim</code>が魅力的だったので使ってみました。
denoはテストを標準でサポートしているし、型システムもあるので、開発体験としてはとても良かったです。</p><p>ちょっと話逸れましたが、<code>command.vim</code>では自動補完以外の処理は基本<code>deno</code>側でやっています。
たとえば、バッファを開く時の処理は以下のようになっています。<code>denops.vim</code>は<code>vim.cmd()</code>でVimのExコマンド、<code>vim.call</code>でVimの関数を実行できるのでそれを利用しています。</p><div class=highlight><pre class=chroma><code class=language-ts data-lang=ts><span class=c1>// open buffer for execute shell command
</span><span class=c1></span><span class=kr>async</span> <span class=nx>openExecuteBuffer() {</span>
  <span class=c1>// NOTE: using feedkeys because :startinsert doesn&#39;t work well in vim
</span><span class=c1></span>  <span class=k>await</span> <span class=nx>vim</span><span class=p>.</span><span class=nx>cmd</span><span class=p>(</span><span class=sb>`botright 1new | call feedkeys(&#34;i&#34;)`</span><span class=p>);</span>
  <span class=k>await</span> <span class=nx>vim</span><span class=p>.</span><span class=nx>cmd</span><span class=p>(</span>
    <span class=sb>`setlocal buftype=nofile bufhidden=hide noswapfile nonumber nowrap ft=sh`</span><span class=p>,</span>
  <span class=p>);</span>
  <span class=k>await</span> <span class=nx>vim</span><span class=p>.</span><span class=nx>cmd</span><span class=p>(</span>
    <span class=sb>`inoremap &lt;silent&gt; &lt;buffer&gt; &lt;CR&gt; &lt;Esc&gt;:call denops#notify(&#34;</span><span class=si>${</span><span class=nx>vim</span><span class=p>.</span><span class=nx>name</span><span class=si>}</span><span class=sb>&#34;, &#34;executeShellCommand&#34;, [&amp;shell])&lt;CR&gt;`</span><span class=p>,</span>
  <span class=p>);</span>
  <span class=k>await</span> <span class=nx>vim</span><span class=p>.</span><span class=nx>cmd</span><span class=p>(</span><span class=sb>`nnoremap &lt;silent&gt; &lt;buffer&gt; &lt;C-c&gt; :bw!&lt;CR&gt;`</span><span class=p>);</span>
  <span class=k>await</span> <span class=nx>vim</span><span class=p>.</span><span class=nx>cmd</span><span class=p>(</span><span class=sb>`inoremap &lt;silent&gt; &lt;buffer&gt; &lt;C-c&gt; &lt;Esc&gt;:bw!&lt;CR&gt;`</span><span class=p>);</span>
  <span class=k>await</span> <span class=nx>vim</span><span class=p>.</span><span class=nx>call</span><span class=p>(</span><span class=sb>`command#complete#enable`</span><span class=p>);</span>
<span class=p>},</span>
</code></pre></div><p><code>command#complete#enable</code>は自動補完を有効化し、シェル履歴を取得しています。
これはVim scriptで書くしかなかったので、<code>autoload</code>に定義しています。</p><div class=highlight><pre class=chroma><code class=language-vim data-lang=vim><span class=k>fun</span><span class=p>!</span> <span class=nx>s</span>:<span class=nx>complete</span><span class=p>()</span> <span class=nx>abort</span><span class=err>
</span><span class=err></span>  <span class=nx>call</span> <span class=nx>feedkeys</span><span class=p>(</span><span class=s2>&#34;\&lt;C-x&gt;\&lt;C-u&gt;&#34;</span><span class=p>)</span><span class=err>
</span><span class=err></span><span class=nx>endfun</span><span class=err>
</span><span class=err>
</span><span class=err></span><span class=k>fun</span><span class=p>!</span> <span class=nx>command</span>#<span class=nx>complete</span>#<span class=nx>enable</span><span class=p>()</span> <span class=nx>abort</span><span class=err>
</span><span class=err></span>  <span class=k>let</span> <span class=nx>b</span>:<span class=nx>histories</span> <span class=p>=</span> <span class=nx>denops</span>#<span class=nx>request</span><span class=p>(</span><span class=s2>&#34;command&#34;</span><span class=p>,</span> <span class=s2>&#34;getShellHistory&#34;</span><span class=p>,</span> [&amp;<span class=nx>shell</span>]<span class=p>)</span><span class=err>
</span><span class=err></span>  <span class=k>if</span> <span class=nx>empty</span><span class=p>(</span><span class=nx>b</span>:<span class=nx>histories</span><span class=p>)</span><span class=err>
</span><span class=err></span>    <span class=nx>return</span><span class=err>
</span><span class=err></span>  <span class=k>endif</span><span class=err>
</span><span class=err>
</span><span class=err></span>  <span class=nx>setlocal</span> <span class=nx>completefunc</span><span class=p>=</span><span class=nx>command</span>#<span class=nx>complete</span>#<span class=nx>shell_history</span><span class=err>
</span><span class=err>
</span><span class=err></span>  <span class=k>let</span> <span class=nx>s</span>:<span class=nx>old_completeopt</span> <span class=p>=</span> &amp;<span class=nx>completeopt</span><span class=err>
</span><span class=err></span>  <span class=nx>set</span> <span class=nx>completeopt</span><span class=p>+=</span><span class=nx>noinsert</span><span class=p>,</span><span class=nx>menuone</span><span class=p>,</span><span class=nx>noselect</span><span class=err>
</span><span class=err>
</span><span class=err></span>  <span class=nx>augroup</span> <span class=nx>denops</span><span class=p>-</span><span class=nx>command</span><span class=p>-</span><span class=nx>complete</span><span class=err>
</span><span class=err></span>    <span class=nx>autocmd</span><span class=p>!</span><span class=err>
</span><span class=err></span>    <span class=nx>autocmd</span> <span class=nx>InsertCharPre</span> <span class=p>&lt;</span><span class=nx>buffer</span><span class=p>&gt;</span> <span class=nx>call</span> <span class=nx>s</span>:<span class=nx>complete</span><span class=p>()</span><span class=err>
</span><span class=err></span>    <span class=nx>autocmd</span> <span class=nx>BufWipeout</span> <span class=p>&lt;</span><span class=nx>buffer</span><span class=p>&gt;</span> <span class=nx>call</span> <span class=nx>s</span>:<span class=nx>wipe_buffer</span><span class=p>()</span><span class=err>
</span><span class=err></span>  <span class=nx>augroup</span> <span class=nx>END</span><span class=err>
</span><span class=err></span><span class=nx>endfun</span><span class=err>
</span></code></pre></div><h3 id=ハマったポイント>ハマったポイント<a href=#ハマったポイント class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h3><h4 id=completefuncとcompleteopt><code>completefunc</code>と<code>completeopt</code><a href=#completefuncとcompleteopt class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h4><p><code>command.vim</code>を実装する上で、自動補完にかなりハマってしまいました。
まず<code>completefunc</code>は<code>&lt;C-x>&lt;C-u></code>で補完するときの関数を指定するのですが、関数が呼ばれるしくみを理解するのに時間がかかりました。
何度も試しながら、少しずつ理解していったという感じです。</p><p>そして、<code>completeopt</code>は補完の細かい動作を変更するオプションですが、<code>completefunc</code>はバッファごとに設定できるのに対して<code>completeopt</code>はグローバルの設定になっています。
<code>completeopt</code>の設定をコマンドの実行完了と同時に、もとに戻さなければほかのプラグインが動作しなくなることがあります。
特に補完プラグインはこのオプションを使っていることが多いので注意が必要です。</p><h4 id=自動補完>自動補完<a href=#自動補完 class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h4><p>入力するたびに、<code>&lt;C-x>&lt;C-u></code>で補完を実行すれば自動補完が完成ですが、ここでもかなりハマりました。
Vimには<code>autocmd</code>という、何かを操作するたびに発生するイベントをhookして処理できるしくみがあります。
入力に関しては主に以下のイベントがあります。</p><ul><li>TextChanged: ノーマルモードでテキストを変更した場合</li><li>TextChangedI: 挿入モードでテキストを変更した場合</li><li>TextChangedP: 挿入モードでテキストが変更されてポップアップウィンドウが表示されている場合</li></ul><p>補完は挿入モードで行えばよいので、<code>TextChangedI</code>の<code>autocmd</code>を定義すればよいと思ったんですが、<code>completefunc</code>はテキストを変更してしまうため、<code>autocmd(TextChangedI)</code> -> <code>completefunc</code> -> テキストが変更される -> <code>autocmd(TextChangedI)</code> -> <code>completefunc</code> &mldr; というふうに無限ループになってしまいました。</p><p>結局回避方法がよく分からなかったので、<code>InsertCharPre</code>イベントと<code>feedkeys</code>を使って自動補完を実装しました。
<code>InsertCharPre</code>は入力したテキストがバッファに書き込まれる前に動くので<code>autocmd</code>時点では入力したテキストを取得できないんですが、<code>feedkeys</code>は非同期で動作するので、
実際<code>&lt;C-x>&lt;C-u></code>が実行されるのはバッファにテキストが書き込まれたあとのタイミングになるようです。
そのため、この組み合わせであればまず補完は問題なく動くという感じです。</p><h4 id=シェル履歴ファイル>シェル履歴ファイル<a href=#シェル履歴ファイル class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h4><p><code>command.vim</code>が対応しているシェルは<code>bash</code>、<code>zsh</code>、<code>fish</code>の3種類ですが、これらの履歴フォーマットがすべて異なっています。
<code>bash</code>と<code>zsh</code>は次のようなシンプルなテキストになっていますが、改行がある場合のフォーマットが異なっています。</p><pre><code>vim
echo
ls -la
...
</code></pre><p><code>bash</code>の場合は<code>\n</code>として記録しますが、<code>zsh</code>は改行ごとで区切っています。
たとえば、次のコマンドを入力した場合、<code>bash</code>は<code>echo 1 2</code>として記録しますが、<code>zsh</code>は<code>echo 1\\</code>と<code>2</code>で別れます。</p><pre><code>echo 1 \
2
</code></pre><p>更に<code>fish</code>の場合は次のフォーマットになっていて、時間と場所とコマンドの接頭辞がついています。</p><pre><code>- cmd: echo 1 \\\n2
  when: 1611401590
  paths:
    - tmux
</code></pre><p>このような差分を吸収しつつ、改行の場合は1行に整形する必要があり、ちょっと面倒でした。</p><h4 id=ターミナルのif違い>ターミナルのIF違い<a href=#ターミナルのif違い class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h4><p><code>Vim</code>と<code>Neovim</code>のターミナルのIFが異なる部分もちょっとハマリポイントでした。
<code>Neovim</code>の場合シェルを経由してコマンドが実行されるので、<code>:term echo $EDITOR</code>を実行すると<code>vim</code>が出ますが、
<code>Vim</code>はシェルを経由しないため<code>$EDITOR</code>と出ます。</p><p>幸いなことに、Vimは去年あたりに<code>++shell</code>オプションが追加されたので<code>:term ++shell echo $EDITOR</code>と実行すればシェル経由してくれます。
それを使って<code>:terminal</code>の動作を統一しました。</p><div class=highlight><pre class=chroma><code class=language-ts data-lang=ts><span class=k>if</span> <span class=p>(</span><span class=k>await</span> <span class=nx>vim</span><span class=p>.</span><span class=nx>call</span><span class=p>(</span><span class=sb>`has`</span><span class=p>,</span> <span class=s2>&#34;nvim&#34;</span><span class=p>))</span> <span class=p>{</span>
  <span class=k>await</span> <span class=nx>vim</span><span class=p>.</span><span class=nx>cmd</span><span class=p>(</span><span class=sb>`new`</span><span class=p>);</span>
  <span class=k>await</span> <span class=nx>vim</span><span class=p>.</span><span class=nx>call</span><span class=p>(</span><span class=sb>`termopen`</span><span class=p>,</span> <span class=nx>cmd</span><span class=p>);</span>
<span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
  <span class=k>await</span> <span class=nx>vim</span><span class=p>.</span><span class=nx>cmd</span><span class=p>(</span><span class=sb>`terminal ++shell </span><span class=si>${</span><span class=nx>cmd</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
  <span class=k>await</span> <span class=nx>vim</span><span class=p>.</span><span class=nx>cmd</span><span class=p>(</span><span class=sb>`nnoremap &lt;buffer&gt; &lt;silent&gt; &lt;CR&gt; :bw&lt;CR&gt;`</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div><h2 id=最後に>最後に<a href=#最後に class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2><p>サクッと作れるのかなと思ってやってみたら以外とハマリポイントが多く、結局時間が掛かってしまいました。
<code>vim-jp</code>でいろいろ質問しながら、なんとか形にできたのは良かったです。
特に<a href=https://twitter.com/ShougoMatsu>暗黒美無王のShougoさん</a>と<a href=https://github.com/hrsh7th/vim-vsnip>vim-vsnip</a>の作者の<a href=https://twitter.com/hrsh7th>hrsh7thさん</a>が教えてくれていたので、この場を借りてあらめてお礼を申し上げます。ありがとうございました！</p></div><hr class=post-end><footer class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=tag><a href=https://skanehira.github.io/blog/tags/Vim>Vim</a></span><span class=tag><a href=https://skanehira.github.io/blog/tags/denops>denops</a></span><span class=tag><a href=https://skanehira.github.io/blog/tags/deno>deno</a></span></p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg></p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>2021/05/20 00:00</p></footer></article><aside id=toc><div class=toc-title></div><nav id=TableOfContents><ul><li><a href=#初めに>初めに</a></li><li><a href=#使い方>使い方</a></li><li><a href=#しくみ>しくみ</a><ul><li><a href=#ハマったポイント>ハマったポイント</a></li></ul></li><li><a href=#最後に>最後に</a></li></ul></nav></aside><div class="post-nav thin"><a class=next-post href=https://skanehira.github.io/blog/posts/20210603-docker-new-compose/><span class=post-nav-label><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>&nbsp;</span><br><span>新しい docker compose</span></a>
<a class=prev-post href=https://skanehira.github.io/blog/posts/20210514-go-slack-reminder/><span class=post-nav-label>&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg></span><br><span>Slackのreminder使いづらすぎたのでCLIを作った</span></a></div><div id=comments class=thin></div></main><footer id=site-footer class="section-inner thin animated fadeIn faster"><p>&copy; 2022 <a href=https://skanehira.github.io/blog/>skanehira</a></p><p>Made with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> &#183; Theme <a href=https://github.com/Track3/hermit target=_blank rel=noopener>Hermit</a> &#183; <a href=https://skanehira.github.io/blog/posts/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></p></footer><script src=https://skanehira.github.io/blog/js/bundle.min.4a9a0ac3d2217822c7865b4161e6c2a71de1d70492264337755427898dd718f6.js integrity="sha256-SpoKw9IheCLHhltBYebCpx3h1wSSJkM3dVQniY3XGPY=" crossorigin=anonymous></script></body></html>