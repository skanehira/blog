<!doctype html><html lang=ja><head><meta charset=utf-8><base href=https://skanehira.github.io/blog/><link rel=canonical href=https://skanehira.github.io/blog/posts/20190812-vim-terminal/><meta name=viewport content="width=device-width,initial-scale=1"><title>Vimのターミナルの真の力お見せしますよ | ゴリラ@転生したら人間だった件</title><meta name=description content="はじめに みなさん、こんにちわ 個人ブログにVimの記事しかないゴリラです。 そして今回、またしてもVimです。 Vimの高度な編集を行うことができ"><meta property="og:title" content="Vimのターミナルの真の力お見せしますよ | ゴリラ@転生したら人間だった件"><meta property="og:type" content="article"><meta property="og:url" content="https://skanehira.github.io/blog/posts/20190812-vim-terminal/"><meta property="og:site_name" content="ゴリラ@転生したら人間だった件"><meta property="og:description" content="はじめに みなさん、こんにちわ 個人ブログにVimの記事しかないゴリラです。 そして今回、またしてもVimです。 Vimの高度な編集を行うことができ"><link rel=stylesheet href=https://skanehira.github.io/blog/css/reset.524633911eadaf3cb674408574038ab61826bbd094638faef366ddcaf13e56ab.css><link rel=stylesheet href=https://skanehira.github.io/blog/scss/style.10edae46d9f81f5614a2948ad849646e1db60c0a332e3c53c5b62027c7ba5018.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.8.2/css/all.css as=style onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.8.2/css/all.css></noscript><script>!function(t){"use strict";t.loadCSS||(t.loadCSS=function(){});var e=loadCSS.relpreload={};if(e.support=function(){var e;try{e=t.document.createElement("link").relList.supports("preload")}catch(a){e=!1}return function(){return e}}(),e.bindMediaToggle=function(t){function e(){t.addEventListener?t.removeEventListener("load",e):t.attachEvent&&t.detachEvent("onload",e),t.setAttribute("onload",null),t.media=a}var a=t.media||"all";t.addEventListener?t.addEventListener("load",e):t.attachEvent&&t.attachEvent("onload",e),setTimeout(function(){t.rel="stylesheet",t.media="only x"}),setTimeout(e,3e3)},e.poly=function(){if(!e.support())for(var a=t.document.getElementsByTagName("link"),n=0;n<a.length;n++){var o=a[n];"preload"!==o.rel||"style"!==o.getAttribute("as")||o.getAttribute("data-loadcss")||(o.setAttribute("data-loadcss",!0),e.bindMediaToggle(o))}},!e.support()){e.poly();var a=t.setInterval(e.poly,500);t.addEventListener?t.addEventListener("load",function(){e.poly(),t.clearInterval(a)}):t.attachEvent&&t.attachEvent("onload",function(){e.poly(),t.clearInterval(a)})}"undefined"!=typeof exports?exports.loadCSS=loadCSS:t.loadCSS=loadCSS}("undefined"!=typeof global?global:this);</script></head><body class=m-body><header class=m-global-header><div class=m-logo><a class=m-logo__link href=/blog>ゴリラ@転生したら人間だった件</a></div><div class=m-global-menu><nav class=m-global-menu__navigation><ul class=m-global-menu__navigation-list><li class=m-global-menu__navigation-list-item><a class=m-global-menu__navigation-list-item-link href=/blog/>Home</a></li><li class=m-global-menu__navigation-list-item><a class=m-global-menu__navigation-list-item-link href=/blog/posts>Posts</a></li><li class=m-global-menu__navigation-list-item><a class=m-global-menu__navigation-list-item-link href=https://github.com/skanehira>GitHub</a></li><li class=m-global-menu__navigation-list-item><a class=m-global-menu__navigation-list-item-link href=https://twitter.com/gorilla0513>Twitter</a></li></ul></nav></div></header><main class=m-main><div class=m-main-container><div class=m-content-container><article class=m-entry><div class=m-entry__breadcrumbs><div class=a-breadcrumbs><ul class=a-breadcrumbs__list itemscope itemtype=http://schema.org/BreadcrumbList><li class=a-breadcrumbs__list-item itemscope itemprop=itemListElement itemtype=http://schema.org/ListItem><a class=a-breadcrumbs__list-item-link href=https://skanehira.github.io/blog/ itemprop=item><span itemprop=name>Home</span></span><meta itemprop=position content="1"></a><span class=a-breadcrumbs__list-item-link-gt>></span></li><li class=a-breadcrumbs__list-item itemscope itemprop=itemListElement itemtype=http://schema.org/ListItem><a class=a-breadcrumbs__list-item-link href=https://skanehira.github.io/blog/posts/ itemprop=item><span itemprop=name>Posts</span><meta itemprop=position content="2"></a><span class=a-breadcrumbs__list-item-link-gt>></span></li><li class=a-breadcrumbs__list-item itemscope itemprop=itemListElement itemtype=http://schema.org/ListItem><a class=a-breadcrumbs__list-item-link href=https://skanehira.github.io/blog/posts/20190812-vim-terminal/ itemprop=item><span itemprop=name>Vimのターミナルの真の力お見せしますよ</span><meta itemprop=position content="3"></a></li></ul></div></div><div class=m-entry__header><div class=m-entry__header-taxonomies><div class=m-entry__header-taxonomies-category><span class=m-entry__header-taxonomies-category-title><a class=m-entry__header-taxonomies-category-title-link href=https://skanehira.github.io/blog/posts/>Posts</a></span></div></div><div class=m-entry__header-title><a class=m-entry__header-title-link href=https://skanehira.github.io/blog/posts/20190812-vim-terminal/><h1 class=m-entry__header-title-link-text>Vimのターミナルの真の力お見せしますよ</h1></a></div><div class=m-entry__header-date><time>2019/08/12</time></div></div><div class=m-entry__content><h2 id=はじめに>はじめに</h2><p>みなさん、こんにちわ</p><p>個人ブログにVimの記事しかない<a href=https://twitter.com/gorilla0513>ゴリラ</a>です。
そして今回、またしてもVimです。</p><p>Vimの高度な編集を行うことができる上、ターミナルを操作することもできてしまいます。
エディタでありながら端末でもある、夢の様なエディタです。</p><p>そんなVimのターミナル機能について触れている記事をあまり見かけたことがないので、
今回はVimのターミナルの便利な使い方についていくつか紹介していきます。</p><h2 id=端末の起動>端末の起動</h2><p><code>:term</code>でターミナルを起動できます。</p><p><img src=https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/66178/891c526f-47f4-1f82-dba1-eb56a5d7bffe.png alt=image.png></p><p>デフォルトでは画面上部にターミナルウィンドウを表示します。
分割方向を変えたい場合は次のようにします。</p><table><thead><tr><th>コマンド</th><th>説明</th></tr></thead><tbody><tr><td>:vert term</td><td>垂直分割して開く</td></tr><tr><td>:bo term</td><td>水平分割して画面最下部にウィンドウを開く</td></tr><tr><td>:top term</td><td>水平分割して画面最上部にウィンドウを開く</td></tr></tbody></table><p>他にもいくつかコマンドがありますので、<code>:h vert</code>でヘルプを引いてそのあたりを参照してください。</p><h2 id=ターミナルでの操作>ターミナルでの操作</h2><p>ターミナルでは入力したキーはそのまま端末に送られます。
ウィンドウのフォーカスの移動などに関しては特別な操作が必要です。
最低限の操作は次になります。<code>CTRL-W</code>がプレフィックスキーになっています。</p><table><thead><tr><th>キーマップ</th><th>説明</th></tr></thead><tbody><tr><td>CTRL-W w</td><td>次のウィンドウにフォーカスを当てる</td></tr><tr><td>CTRL-W N</td><td>ターミナルノーマルモードに移行</td></tr><tr><td>CTRL-W .</td><td>端末にCTRL-Wを送る</td></tr><tr><td>CTRL-W :</td><td>コマンドラインモードに移行</td></tr><tr><td>CTRL-W " {reg}</td><td>レジスタの中身を貼り付ける</td></tr></tbody></table><h2 id=端末の内容をヤンク>端末の内容をヤンク</h2><p>Vimのターミナルウィンドウで<code>CTRL-W N</code>を押下するとターミナルの出力を一時的に保留します。
この状態をターミナルノーマルモードと言います。このモードは普通のウィンドウと同様カーソル移動、ヤンク、検索を行うことができます。</p><p>ただ、<code>i</code>や<code>A</code>などのコマンドは挿入モードではなく、通常のターミナルモードに戻るようになっています。</p><p><img src=https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/66178/b91812b1-6d5e-dd2d-8109-226af23b59f2.gif alt=vim-terminal-yank.gif></p><p>ターミナルノーマルモードを使用することで、<code>less</code>や<code>tail</code>コマンドの出力、また作業ログを簡単にメモに残すことができます。</p><h2 id=外部コマンドとの連携>外部コマンドとの連携</h2><p>Vimでは<code>:!echo gorilla</code>というように<code>:!</code>を使用することで外部コマンドを実行することができます。しかし、それだとコマンドの実行が完了するまでVimを操作できないです。とてもツライ。</p><p>そこでターミナルを使えば非同期で外部コマンドを実行することができます。
コマンドを実行している間にVimの操作がブロックされないのはとても大きいですね。
では、いくつか例を紹介します。</p><h3 id=git-log>git log</h3><p><code>:vert term ++close git log</code>でGitのログを確認することができます。
単にターミナル上で動いているので、いつも通り<code>q</code>で<code>git log</code>を終了できます。
この例だと<code>++close</code>というオプションをわたしていますが、これは外部コマンドが終了するとウィンドウを自動で閉じるオプションです。</p><p><img src=https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/66178/fcfaaba5-53b8-9414-cca5-f8fea634481a.gif alt=vim-terminal-git-log.gif></p><h3 id=git-blame>git blame</h3><p><code>:term ++close git blame %</code>でファイルの変更履歴を確認することができます。
<code>%</code>は現在開いているファイル名になります。</p><p><img src=https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/66178/22b3faab-16bc-e035-8d74-066cf13e0639.gif alt=vim-terminal-git.gif></p><h3 id=インタラクティブにgitを操作>インタラクティブにgitを操作</h3><p>gitコマンドの実行方法を紹介しましたが、gitをインタラクティブに操作できる<a href=https://github.com/jesseduffield/lazygit>lazygit</a>というTUIツールがあります。
こちらも同様に<code>:vert term ++close lazygit</code>で実行できます。
こちらのツールはとても便利なので、ぜひ試してみてください。</p><p><img src=https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/66178/a79a7356-ce1d-3d07-427f-44ce78526547.gif alt=vim-terminal-lazygit.gif></p><h3 id=replを使う>REPLを使う</h3><p>コーディング中に言語の細かい動きやちょっとしたサンプルコードの実行をしたいときがあります。
REPL<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>を使用することで、インタラクティブにコードを実行する事ができます。
有名ところだと、<code>PHP -a</code>や<code>node</code>などがあります。</p><p>ぼくは普段Goを書いたりするので、<a href=https://github.com/motemen/gore>gore</a>を使っています。
goreの場合、<code>:vert term ++close gore</code>で起動できます。</p><p><img src=https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/66178/f23a0021-2b72-16e1-313a-f1d963b1bde7.gif alt=vim-terminal-repl.gif></p><h3 id=コンテナを管理>コンテナを管理</h3><p>コンテナ技術がインフラを支える様になった昨今、開発も環境もコンテナを使用することが増えていきました。
コーディング中にコンテナを操作したいことがあります。</p><p>そこで、ぼくが作った<a href=https://github.com/skanehira/docui>docui</a>というTUIツールを使用することでターミナル上でインタラクティブにコンテナやイメージなどを管理することができます。
lazygitと同様<code>:vert term ++close docui</code>でコンテナを操作しつつコーディングできます。</p><p><img src=https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/66178/6f0ce6d8-34d6-3a77-0fc0-a1ff56b5a5aa.gif alt=vim-terminal-docui.gif></p><p>ちなみに、コンテナを操作するだけなら<a href=https://github.com/skanehira/docker.vim>docker.vim</a>というプラグインがあります。
こちらはターミナルを使わずにVimのインターフェイスのみで操作できるようになっています。
興味ある方はぜひ使ってみてください。</p><h3 id=スターウォーズ>スターウォーズ</h3><p>コーディング中にスターウォーズを見たくなるときがあります。
そんなときは<a href=https://github.com/skanehira/go-starwars>go-starwars</a>を導入して、<code>:term ++close go-starwars -s 20</code>を実行してコーディングしながら見ます。</p><p><img src=https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/66178/14038dad-0b31-603b-9731-97f2b90d202e.gif alt=vim-terminal-starwars.gif></p><h3 id=tmuxの代わりに使う>tmuxの代わりに使う</h3><p><a href=https://github.com/tmux/tmux/wiki>tmux</a>を使うことで、画面を分割したり、ターミナルソフトを終了してもセッションを復帰することで状態を復元できます。
Vimはセッションと言う機能があり、ターミナルと組み合わせることでtmuxと近いことができます。</p><p>こちらについては先日に<a href=https://gorilla.netlify.com/articles/20190803-vim-tmux.html>Vimをtmuxの代わりに使う</a>という記事を書いたので、そちらを参照してください。</p><h2 id=補足>補足</h2><p>本記事で紹介した内容は<a href=https://techbookfest.org/event/tbf07>技術書典7</a>で出す予定の「Vimが好きになる本」の一部です。
<img src=https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/66178/3ddaf388-8cb9-6ad7-39e5-6ffc66c6da6b.png alt=image.png></p><p>本書はVim初心者から中級者向けにVimの基本機能から便利なコマンドについて解説しています。
現在執筆中のため、一部の目次を紹介します。無料版も有料版もオンラインと会場で配布する予定です。</p><p><img src=https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/66178/9fb8ea31-c5b8-d348-73e8-b15dc5eb4a04.png alt=image.png>
<img src=https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/66178/c3542225-0302-ea2d-7197-532dd315e0e3.png alt=image.png></p><h2 id=まとめ>まとめ</h2><p>Vimのターミナルは便利です。
そのままターミナルを使うのも良いですが、外部コマンドと連携するのもまた便利です。
つまりVim最高！</p><section class=footnotes role=doc-endnotes><hr><ol><li id=fn:1 role=doc-endnote><p>Read-Eval-Print Loopの略、入力・評価・出力のループのこと。 <a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></section></div><div class=m-entry__footer><div class=m-entry__footer-sns-buttons><a class=m-entry__footer-sns-buttons-icon-hatebu href="https://b.hatena.ne.jp/my/add.confirm?title=Vim%E3%81%AE%E3%82%BF%E3%83%BC%E3%83%9F%E3%83%8A%E3%83%AB%E3%81%AE%E7%9C%9F%E3%81%AE%E5%8A%9B%E3%81%8A%E8%A6%8B%E3%81%9B%E3%81%97%E3%81%BE%E3%81%99%E3%82%88+%7C+%E3%82%B4%E3%83%AA%E3%83%A9%40%E8%BB%A2%E7%94%9F%E3%81%97%E3%81%9F%E3%82%89%E4%BA%BA%E9%96%93%E3%81%A0%E3%81%A3%E3%81%9F%E4%BB%B6&url=https%3A%2F%2Fskanehira.github.io%2Fblog%2Fposts%2F20190812-vim-terminal%2F" target=_blank rel="noopener noreferrer">B!</a>
<a class=m-entry__footer-sns-buttons-icon href="https://twitter.com/intent/tweet?text=Vim%E3%81%AE%E3%82%BF%E3%83%BC%E3%83%9F%E3%83%8A%E3%83%AB%E3%81%AE%E7%9C%9F%E3%81%AE%E5%8A%9B%E3%81%8A%E8%A6%8B%E3%81%9B%E3%81%97%E3%81%BE%E3%81%99%E3%82%88+%7C+%E3%82%B4%E3%83%AA%E3%83%A9%40%E8%BB%A2%E7%94%9F%E3%81%97%E3%81%9F%E3%82%89%E4%BA%BA%E9%96%93%E3%81%A0%E3%81%A3%E3%81%9F%E4%BB%B6&url=https%3A%2F%2Fskanehira.github.io%2Fblog%2Fposts%2F20190812-vim-terminal%2F" target=_blank rel="noopener noreferrer"><i class="fab fa-twitter">&nbsp;</i></a>
<a class=m-entry__footer-sns-buttons-icon href="https://www.facebook.com/sharer.php?u=https%3A%2F%2Fskanehira.github.io%2Fblog%2Fposts%2F20190812-vim-terminal%2F" target=_blank rel="noopener noreferrer"><i class="fab fa-facebook">&nbsp;</i></a></div></div><div class=m-entry__page-navigation><a class=m-entry__page-navigation-link href=https://skanehira.github.io/blog/posts/20190916-vim-book/>&lt; prev</a>
<a class=m-entry__page-navigation-link href=https://skanehira.github.io/blog/posts/20190803-vim-tmux/>next ></a></div><div class=m-entry__breadcrumbs><div class=a-breadcrumbs><ul class=a-breadcrumbs__list itemscope itemtype=http://schema.org/BreadcrumbList><li class=a-breadcrumbs__list-item itemscope itemprop=itemListElement itemtype=http://schema.org/ListItem><a class=a-breadcrumbs__list-item-link href=https://skanehira.github.io/blog/ itemprop=item><span itemprop=name>Home</span></span><meta itemprop=position content="1"></a><span class=a-breadcrumbs__list-item-link-gt>></span></li><li class=a-breadcrumbs__list-item itemscope itemprop=itemListElement itemtype=http://schema.org/ListItem><a class=a-breadcrumbs__list-item-link href=https://skanehira.github.io/blog/posts/ itemprop=item><span itemprop=name>Posts</span><meta itemprop=position content="2"></a><span class=a-breadcrumbs__list-item-link-gt>></span></li><li class=a-breadcrumbs__list-item itemscope itemprop=itemListElement itemtype=http://schema.org/ListItem><a class=a-breadcrumbs__list-item-link href=https://skanehira.github.io/blog/posts/20190812-vim-terminal/ itemprop=item><span itemprop=name>Vimのターミナルの真の力お見せしますよ</span><meta itemprop=position content="3"></a></li></ul></div></div></article></div><div class=m-aside-container><div class=m-aside-widget__profile><div class=m-aside-widget__profile-avatar></div><div class=m-aside-widget__profile-author></div><div class=m-aside-widget__profile-description></div></div></div></div></main><footer class=m-global-footer><span class=a-copy-right>Copyright 2021
All rights reserved.</span></footer></body></html>