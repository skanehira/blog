<!doctype html><html lang=ja><head><meta charset=utf-8><base href=https://skanehira.github.io/blog/><link rel=canonical href=https://skanehira.github.io/blog/posts/20181215-vim-session/><meta name=viewport content="width=device-width,initial-scale=1"><title>Vimのセッション機能を使う | ゴリラ@転生したら人間だった件</title><meta name=description content="みなさん、vimにセッション機能があるのはご存知でしょうか？ 便利そうなので使ってみようと思っていますが、せっかくなのでVim scriptの勉"><meta property="og:title" content="Vimのセッション機能を使う | ゴリラ@転生したら人間だった件"><meta property="og:type" content="article"><meta property="og:url" content="https://skanehira.github.io/blog/posts/20181215-vim-session/"><meta property="og:site_name" content="ゴリラ@転生したら人間だった件"><meta property="og:description" content="みなさん、vimにセッション機能があるのはご存知でしょうか？ 便利そうなので使ってみようと思っていますが、せっかくなのでVim scriptの勉"><link rel=stylesheet href=https://skanehira.github.io/blog/css/reset.524633911eadaf3cb674408574038ab61826bbd094638faef366ddcaf13e56ab.css><link rel=stylesheet href=https://skanehira.github.io/blog/scss/style.10edae46d9f81f5614a2948ad849646e1db60c0a332e3c53c5b62027c7ba5018.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.8.2/css/all.css as=style onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.8.2/css/all.css></noscript><script>!function(t){"use strict";t.loadCSS||(t.loadCSS=function(){});var e=loadCSS.relpreload={};if(e.support=function(){var e;try{e=t.document.createElement("link").relList.supports("preload")}catch(a){e=!1}return function(){return e}}(),e.bindMediaToggle=function(t){function e(){t.addEventListener?t.removeEventListener("load",e):t.attachEvent&&t.detachEvent("onload",e),t.setAttribute("onload",null),t.media=a}var a=t.media||"all";t.addEventListener?t.addEventListener("load",e):t.attachEvent&&t.attachEvent("onload",e),setTimeout(function(){t.rel="stylesheet",t.media="only x"}),setTimeout(e,3e3)},e.poly=function(){if(!e.support())for(var a=t.document.getElementsByTagName("link"),n=0;n<a.length;n++){var o=a[n];"preload"!==o.rel||"style"!==o.getAttribute("as")||o.getAttribute("data-loadcss")||(o.setAttribute("data-loadcss",!0),e.bindMediaToggle(o))}},!e.support()){e.poly();var a=t.setInterval(e.poly,500);t.addEventListener?t.addEventListener("load",function(){e.poly(),t.clearInterval(a)}):t.attachEvent&&t.attachEvent("onload",function(){e.poly(),t.clearInterval(a)})}"undefined"!=typeof exports?exports.loadCSS=loadCSS:t.loadCSS=loadCSS}("undefined"!=typeof global?global:this);</script></head><body class=m-body><header class=m-global-header><div class=m-logo><a class=m-logo__link href=/blog>ゴリラ@転生したら人間だった件</a></div><div class=m-global-menu><nav class=m-global-menu__navigation><ul class=m-global-menu__navigation-list><li class=m-global-menu__navigation-list-item><a class=m-global-menu__navigation-list-item-link href=/blog/>Home</a></li><li class=m-global-menu__navigation-list-item><a class=m-global-menu__navigation-list-item-link href=/blog/posts>Posts</a></li><li class=m-global-menu__navigation-list-item><a class=m-global-menu__navigation-list-item-link href=https://github.com/skanehira>GitHub</a></li><li class=m-global-menu__navigation-list-item><a class=m-global-menu__navigation-list-item-link href=https://twitter.com/gorilla0513>Twitter</a></li></ul></nav></div></header><main class=m-main><div class=m-main-container><div class=m-content-container><article class=m-entry><div class=m-entry__breadcrumbs><div class=a-breadcrumbs><ul class=a-breadcrumbs__list itemscope itemtype=http://schema.org/BreadcrumbList><li class=a-breadcrumbs__list-item itemscope itemprop=itemListElement itemtype=http://schema.org/ListItem><a class=a-breadcrumbs__list-item-link href=https://skanehira.github.io/blog/ itemprop=item><span itemprop=name>Home</span></span><meta itemprop=position content="1"></a><span class=a-breadcrumbs__list-item-link-gt>></span></li><li class=a-breadcrumbs__list-item itemscope itemprop=itemListElement itemtype=http://schema.org/ListItem><a class=a-breadcrumbs__list-item-link href=https://skanehira.github.io/blog/posts/ itemprop=item><span itemprop=name>Posts</span><meta itemprop=position content="2"></a><span class=a-breadcrumbs__list-item-link-gt>></span></li><li class=a-breadcrumbs__list-item itemscope itemprop=itemListElement itemtype=http://schema.org/ListItem><a class=a-breadcrumbs__list-item-link href=https://skanehira.github.io/blog/posts/20181215-vim-session/ itemprop=item><span itemprop=name>Vimのセッション機能を使う</span><meta itemprop=position content="3"></a></li></ul></div></div><div class=m-entry__header><div class=m-entry__header-taxonomies><div class=m-entry__header-taxonomies-category><span class=m-entry__header-taxonomies-category-title><a class=m-entry__header-taxonomies-category-title-link href=https://skanehira.github.io/blog/posts/>Posts</a></span></div></div><div class=m-entry__header-title><a class=m-entry__header-title-link href=https://skanehira.github.io/blog/posts/20181215-vim-session/><h1 class=m-entry__header-title-link-text>Vimのセッション機能を使う</h1></a></div><div class=m-entry__header-date><time>2018/12/15</time></div></div><div class=m-entry__content><p>みなさん、vimに<a href=https://vim-jp.org/vimdoc-ja/usr_21.html#21.4>セッション機能</a>があるのはご存知でしょうか？
便利そうなので使ってみようと思っていますが、せっかくなのでVim scriptの勉強も兼ねてコマンド作ってみました。</p><p>fzf.vimを使うとこんな感じになります。
<img src=https://qiita-image-store.s3.amazonaws.com/0/66178/21a1dc7b-44cc-0e9c-c88d-03d74abf9cbc.png alt=image.png></p><p>以下のコードをvimrcに貼ればそのまま使えるとおもいます。</p><h2 id=2018-12-22-追記>[2018-12-22] 追記</h2><p>プラグイン化しました。
また、記事中のソース若干変更は入っています。
<a href=https://github.com/skanehira/vsession>https://github.com/skanehira/vsession</a></p><h2 id=セッションファイル保存先>セッションファイル保存先</h2><p><code>~/.vim/sessions/</code>配下にセッションファイルを保存します。
ディレクトリがなければ作るようにしています。</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-vim data-lang=vim><span style=color:#586e75>&#34; session path</span>
<span style=color:#719e07>let</span> s:session_path = expand(<span style=color:#2aa198>&#39;~/.vim/sessions&#39;</span>)

<span style=color:#719e07>if</span> !isdirectory(s:session_path)
    call mkdir(s:session_path, <span style=color:#2aa198>&#34;p&#34;</span>)
<span style=color:#719e07>endif</span>
</code></pre></div><h2 id=セッションの保存>セッションの保存</h2><p><code>:SaveSession test1.vim</code>という感じで、セッションファイル名を指定して保存します。
同じファイル名を指定すると上書きされるのでご注意。</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-vim data-lang=vim><span style=color:#586e75>&#34; save session</span>
command! -nargs=<span style=color:#2aa198>1</span> SaveSession call s:saveSession(&lt;f-args&gt;)
<span style=color:#719e07>function</span>! s:saveSession(file)
    execute <span style=color:#2aa198>&#39;silent mksession!&#39;</span> s:session_path . <span style=color:#2aa198>&#39;/&#39;</span> . a:file
<span style=color:#719e07>endfunction</span>
</code></pre></div><h2 id=セッションの復元>セッションの復元</h2><p><code>:LoadSession ~/.vim/sessions/test1.vim</code>という感じで、セッションファイルのパスを指定して読み込みます。</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-vim data-lang=vim><span style=color:#586e75>&#34; load session</span>
command! -nargs=<span style=color:#2aa198>1</span> LoadSession call s:loadSession(&lt;f-args&gt;)
<span style=color:#719e07>function</span>! s:loadSession(file)
    execute <span style=color:#2aa198>&#39;silent source&#39;</span> a:file
<span style=color:#719e07>endfunction</span>
</code></pre></div><p>fzf.vim版はこちらです。</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-vim data-lang=vim>command! FloadSession call fzf#run({
\  <span style=color:#2aa198>&#39;source&#39;</span>: split(glob(s:session_path . <span style=color:#2aa198>&#34;/*&#34;</span>), <span style=color:#2aa198>&#34;\n&#34;</span>),
\  <span style=color:#2aa198>&#39;sink&#39;</span>:    <span style=color:#719e07>function</span>(<span style=color:#2aa198>&#39;s:loadSession&#39;</span>),
\  <span style=color:#2aa198>&#39;options&#39;</span>: <span style=color:#2aa198>&#39;-m -x +s&#39;</span>,
\  <span style=color:#2aa198>&#39;down&#39;</span>:    <span style=color:#2aa198>&#39;40%&#39;</span>})
</code></pre></div><h2 id=セッションの削除>セッションの削除</h2><p><code>:DeleteSession ~/.vim/sessions/test1.vim</code>という感じで、削除します。</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-vim data-lang=vim><span style=color:#586e75>&#34; delete session</span>
command! -nargs=<span style=color:#2aa198>1</span> DeleteSession call s:deleteSession(&lt;f-args&gt;)
<span style=color:#719e07>function</span>! s:deleteSession(file)
    call delete(expand(a:file))
<span style=color:#719e07>endfunction</span>
</code></pre></div><p>fzf.vim版はこちらです。</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-vim data-lang=vim>command! FdeleteSession call fzf#run({
\  <span style=color:#2aa198>&#39;source&#39;</span>: split(glob(s:session_path . <span style=color:#2aa198>&#34;/*&#34;</span>), <span style=color:#2aa198>&#34;\n&#34;</span>),
\  <span style=color:#2aa198>&#39;sink&#39;</span>:    <span style=color:#719e07>function</span>(<span style=color:#2aa198>&#39;s:deleteSession&#39;</span>),
\  <span style=color:#2aa198>&#39;options&#39;</span>: <span style=color:#2aa198>&#39;-m -x +s&#39;</span>,
\  <span style=color:#2aa198>&#39;down&#39;</span>:    <span style=color:#2aa198>&#39;40%&#39;</span>})
</code></pre></div><h2 id=キーマッピング>キーマッピング</h2><p>こんな感じでマッピングしたら楽です。</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-vim data-lang=vim>nnoremap &lt;Leader&gt;se :SaveSession 
nnoremap &lt;Leader&gt;lse :FloadSession&lt;CR&gt;
</code></pre></div><h2 id=参考記事>参考記事</h2><p><a href=https://thinca.hatenablog.com/entry/20100201/1265009821>https://thinca.hatenablog.com/entry/20100201/1265009821</a>
<a href=https://qiita.com/shinshin86/items/6e6cbdb77cb59b87d21f>https://qiita.com/shinshin86/items/6e6cbdb77cb59b87d21f</a>
<a href=http://nanasi.jp/articles/code/io/file-path.html>http://nanasi.jp/articles/code/io/file-path.html</a></p><h2 id=最後に>最後に</h2><p>初めてVim script書いたので、おかしなところがありましたら教えて頂けると助かります。
ちなみに、vimのセッションプラグインはありました。</p><p>使ってないのですが、良さげなので興味ある方はどうぞー</p><p><a href=https://github.com/Shougo/unite-session>https://github.com/Shougo/unite-session</a>
<a href=https://github.com/xolox/vim-session>https://github.com/xolox/vim-session</a></p></div><div class=m-entry__footer><div class=m-entry__footer-sns-buttons><a class=m-entry__footer-sns-buttons-icon-hatebu href="https://b.hatena.ne.jp/my/add.confirm?title=Vim%E3%81%AE%E3%82%BB%E3%83%83%E3%82%B7%E3%83%A7%E3%83%B3%E6%A9%9F%E8%83%BD%E3%82%92%E4%BD%BF%E3%81%86+%7C+%E3%82%B4%E3%83%AA%E3%83%A9%40%E8%BB%A2%E7%94%9F%E3%81%97%E3%81%9F%E3%82%89%E4%BA%BA%E9%96%93%E3%81%A0%E3%81%A3%E3%81%9F%E4%BB%B6&url=https%3A%2F%2Fskanehira.github.io%2Fblog%2Fposts%2F20181215-vim-session%2F" target=_blank rel="noopener noreferrer">B!</a>
<a class=m-entry__footer-sns-buttons-icon href="https://twitter.com/intent/tweet?text=Vim%E3%81%AE%E3%82%BB%E3%83%83%E3%82%B7%E3%83%A7%E3%83%B3%E6%A9%9F%E8%83%BD%E3%82%92%E4%BD%BF%E3%81%86+%7C+%E3%82%B4%E3%83%AA%E3%83%A9%40%E8%BB%A2%E7%94%9F%E3%81%97%E3%81%9F%E3%82%89%E4%BA%BA%E9%96%93%E3%81%A0%E3%81%A3%E3%81%9F%E4%BB%B6&url=https%3A%2F%2Fskanehira.github.io%2Fblog%2Fposts%2F20181215-vim-session%2F" target=_blank rel="noopener noreferrer"><i class="fab fa-twitter">&nbsp;</i></a>
<a class=m-entry__footer-sns-buttons-icon href="https://www.facebook.com/sharer.php?u=https%3A%2F%2Fskanehira.github.io%2Fblog%2Fposts%2F20181215-vim-session%2F" target=_blank rel="noopener noreferrer"><i class="fab fa-facebook">&nbsp;</i></a></div></div><div class=m-entry__page-navigation><a class=m-entry__page-navigation-link href=https://skanehira.github.io/blog/posts/20190123-vim-insert/>&lt; prev</a></div><div class=m-entry__breadcrumbs><div class=a-breadcrumbs><ul class=a-breadcrumbs__list itemscope itemtype=http://schema.org/BreadcrumbList><li class=a-breadcrumbs__list-item itemscope itemprop=itemListElement itemtype=http://schema.org/ListItem><a class=a-breadcrumbs__list-item-link href=https://skanehira.github.io/blog/ itemprop=item><span itemprop=name>Home</span></span><meta itemprop=position content="1"></a><span class=a-breadcrumbs__list-item-link-gt>></span></li><li class=a-breadcrumbs__list-item itemscope itemprop=itemListElement itemtype=http://schema.org/ListItem><a class=a-breadcrumbs__list-item-link href=https://skanehira.github.io/blog/posts/ itemprop=item><span itemprop=name>Posts</span><meta itemprop=position content="2"></a><span class=a-breadcrumbs__list-item-link-gt>></span></li><li class=a-breadcrumbs__list-item itemscope itemprop=itemListElement itemtype=http://schema.org/ListItem><a class=a-breadcrumbs__list-item-link href=https://skanehira.github.io/blog/posts/20181215-vim-session/ itemprop=item><span itemprop=name>Vimのセッション機能を使う</span><meta itemprop=position content="3"></a></li></ul></div></div></article></div><div class=m-aside-container><div class=m-aside-widget__profile><div class=m-aside-widget__profile-avatar></div><div class=m-aside-widget__profile-author></div><div class=m-aside-widget__profile-description></div></div></div></div></main><footer class=m-global-footer><span class=a-copy-right>Copyright 2021
All rights reserved.</span></footer></body></html>